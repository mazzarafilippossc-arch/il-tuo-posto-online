<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Il Tuo Posto Online</title>

<style>
/* MATRIX BACKGROUND */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: black;
  color: #00ff88;
  background-image: url("https://i.imgur.com/2z9Z1ZC.png");
  background-repeat: repeat;
  background-size: 300px;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: -1;
}

/* HERO */
header {
  padding: 80px 20px;
  text-align: center;
}

header h1 {
  font-size: 3rem;
  color: #00ff88;
}

/* CONTENUTO */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 20px;
}

/* FORM */
.form-box {
  background: rgba(0,0,0,0.8);
  padding: 20px;
  border-radius: 12px;
  border: 1px solid #00ff88;
  margin-bottom: 30px;
}

.form-box input,
.form-box textarea {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  background: black;
  color: #00ff88;
  border: 1px solid #00ff88;
}

.form-box button {
  padding: 12px;
  background: #00ff88;
  color: black;
  border: none;
  cursor: pointer;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
  gap: 20px;
}

.card {
  background: rgba(0,0,0,0.85);
  border: 1px solid #00ff88;
  border-radius: 12px;
  cursor: pointer;
}

.card img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

.card .content {
  padding: 10px;
}
</style>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUROdEnMoABumEoYMheN-8x2w-CWfc1GQ",
  authDomain: "il-tuo-posto-online.firebaseapp.com",
  projectId: "il-tuo-posto-online",
  storageBucket: "il-tuo-posto-online.firebasestorage.app",
  messagingSenderId: "640085287509",
  appId: "1:640085287509:web:718a44398dd2050ad92adc"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

/* PUBBLICA */
async function pubblica() {
  const titolo = titoloEl.value;
  const testo = testoEl.value;
  const link = linkEl.value;
  const file = imgEl.files[0];

  let imageUrl = "";
  if (file) {
    const ref = storage.ref("images/" + Date.now() + "_" + file.name);
    await ref.put(file);
    imageUrl = await ref.getDownloadURL();
  }

  await db.collection("ads").add({
    title: titolo,
    text: testo,
    link: link,
    image: imageUrl,
    status: "approved"
  });

  form.reset();
  carica();
}

/* CARICA */
async function carica() {
  grid.innerHTML = "";
  const snap = await db.collection("ads")
    .where("status", "==", "approved")
    .get();

  snap.forEach(doc => {
    const a = doc.data();
    const div = document.createElement("div");
    div.className = "card";
    div.onclick = () => {
      window.location.href = "annuncio.html?id=" + doc.id;
    };
    div.innerHTML = `
      ${a.image ? `<img src="${a.image}">` : ""}
      <div class="content">
        <h3>${a.title}</h3>
        <p>${a.text.substring(0,80)}...</p>
      </div>
    `;
    grid.appendChild(div);
  });
}

window.onload = carica;
</script>
</head>

<body>

<header>
  <h1>Il Tuo Posto Online</h1>
</header>

<div class="container">

<div class="form-box">
  <h2>Pubblica annuncio</h2>
  <form id="form" onsubmit="event.preventDefault(); pubblica();">
    <input id="titoloEl" placeholder="Titolo">
    <textarea id="testoEl" placeholder="Descrizione"></textarea>
    <input id="linkEl" placeholder="Link (facoltativo)">
    <input type="file" id="imgEl">
    <button>Pubblica</button>
  </form>
</div>

<div class="grid" id="grid"></div>

</div>

</body>
</html>
