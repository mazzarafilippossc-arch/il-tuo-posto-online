<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Il Tuo Posto Online</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f3f3f3;
}

/* HERO */
header {
  height: 60vh;
  background: linear-gradient(rgba(0,0,0,.4), rgba(0,0,0,.4)),
  url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600") center/cover no-repeat;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

header h1 {
  font-size: 3rem;
}

/* CONTENUTO */
.container {
  max-width: 1100px;
  margin: 30px auto;
  padding: 0 20px;
}

/* FORM */
.form-box {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,.1);
  margin-bottom: 30px;
}

.form-box input,
.form-box textarea {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
}

.form-box button {
  padding: 12px;
  background: #ff6f61;
  color: white;
  border: none;
  cursor: pointer;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
  gap: 20px;
}

.card {
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0,0,0,.1);
}

.card img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

.card .content {
  padding: 10px;
}

.rules {
  margin-top: 40px;
  padding: 15px;
  background: #fff4f4;
  border: 1px solid #ff6f61;
}
</style>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUROdEnMoABumEoYMheN-8x2w-CWfc1GQ",
  authDomain: "il-tuo-posto-online.firebaseapp.com",
  projectId: "il-tuo-posto-online",
  storageBucket: "il-tuo-posto-online.firebasestorage.app",
  messagingSenderId: "640085287509",
  appId: "1:640085287509:web:718a44398dd2050ad92adc"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

/* PUBBLICA ANNUNCIO */
async function pubblica() {
  const titolo = document.getElementById("titolo").value;
  const testo = document.getElementById("testo").value;
  const file = document.getElementById("img").files[0];

  if (!titolo || !testo) {
    alert("Compila titolo e descrizione");
    return;
  }

  let imageUrl = "";

  if (file) {
    const ref = storage.ref("images/" + Date.now() + "_" + file.name);
    await ref.put(file);
    imageUrl = await ref.getDownloadURL();
  }

  await db.collection("ads").add({
    title: titolo,
    text: testo,
    image: imageUrl,
    status: "approved"
  });

  document.getElementById("form").reset();
  carica();
}

/* CARICA ANNUNCI */
async function carica() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  const snap = await db.collection("ads")
    .where("status", "==", "approved")
    .get();

  snap.forEach(doc => {
    const a = doc.data();
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      ${a.image ? `<img src="${a.image}">` : ""}
      <div class="content">
        <h3>${a.title}</h3>
        <p>${a.text}</p>
      </div>
    `;
    grid.appendChild(div);
  });
}

window.onload = carica;
</script>
</head>

<body>

<header>
  <h1>Il Tuo Posto Online</h1>
</header>

<div class="container">

  <div class="form-box">
    <h2>Pubblica un annuncio gratis</h2>
    <form id="form" onsubmit="event.preventDefault(); pubblica();">
      <input id="titolo" placeholder="Titolo">
      <textarea id="testo" placeholder="Descrizione"></textarea>
      <input type="file" id="img" accept="image/*">
      <button>Pubblica</button>
    </form>
  </div>

  <div class="grid" id="grid"></div>

  <div class="rules">
    Vietati contenuti illegali, offensivi o protetti da copyright.
  </div>

</div>

</body>
</html>
